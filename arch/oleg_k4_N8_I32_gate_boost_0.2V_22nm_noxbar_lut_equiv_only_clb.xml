<!-- 

-->
  
  <architecture>
  
  <!-- ODIN II specific config -->
  <models>

  </models>
  <!-- ODIN II specific config ends -->
 
  <!-- Physical descriptions begin -->
  <layout auto="1.0"/>

		<device>
			<sizing R_minW_nmos="13090.000000" R_minW_pmos="19086.831111" ipin_mux_trans_size="2.000000"/>
			<timing C_ipin_cblock="0.000000e+00" T_ipin_cblock="1.030392e-10"/>
			<area grid_logic_tile_area="14130.86202"/>
			<chan_width_distr>
				<io width="1.000000"/>
				<x distr="uniform" peak="1.000000"/>
				<y distr="uniform" peak="1.000000"/>
			</chan_width_distr>
			<switch_block type="subset" fs="3"/>
		</device>
		<switchlist>
			<switch type="mux" name="0" R="0.000000" Cin="0.000000e+00" Cout="0.000000e+00" Tdel="1.571509e-10" mux_trans_size="2.000000" buf_size="19.000000"/>
		</switchlist>
		<segmentlist>
			<segment freq="1.0" length="1" type="unidir" Rmetal="0.0" Cmetal="0.0">
			<mux name="0"/>
			<sb type="pattern">1 1</sb>
			<cb type="pattern">1</cb>
			</segment>
		</segmentlist>

	  <complexblocklist>
       <!-- Capacity is a unique property of I/Os, it is the maximum number of I/Os that can be placed at the same (X,Y) location on the FPGA -->
      <pb_type name="io" capacity="8">
        <input name="outpad" num_pins="1"/>
        <output name="inpad" num_pins="1"/>
        <clock name="clock" num_pins="1"/>

        <!-- IOs can operate as either inputs or outputs -->
        <mode name="inpad">
          <pb_type name="inpad" blif_model=".input" num_pb="1">
            <output name="inpad" num_pins="1"/>
          </pb_type>
          <interconnect>
            <direct name="inpad" input="inpad.inpad" output="io.inpad">
            <delay_constant max="4.243e-11" in_port="inpad.inpad" out_port="io.inpad"/>
            </direct>
          </interconnect>
      
        </mode>
        <mode name="outpad">
          <pb_type name="outpad" blif_model=".output" num_pb="1">
            <input name="outpad" num_pins="1"/>
          </pb_type>
          <interconnect>
            <direct name="outpad" input="io.outpad" output="outpad.outpad">
            <delay_constant max="1.394e-11" in_port="io.outpad" out_port="outpad.outpad"/>
            </direct>
          </interconnect>
        </mode>

        <fc default_in_type="frac" default_in_val="0.2" default_out_type="frac" default_out_val="0.10"/>

        <!-- IOs go on the periphery of the FPGA, for consistency, 
          make it physically equivalent on all sides so that only one definition of I/Os is needed.
          If I do not make a physically equivalent definition, then I need to define 4 different I/Os, one for each side of the FPGA
        -->
        <pinlocations pattern="custom">
          <loc side="left">io.outpad io.inpad io.clock</loc>
          <loc side="top">io.outpad io.inpad io.clock</loc>
          <loc side="right">io.outpad io.inpad io.clock</loc>
          <loc side="bottom">io.outpad io.inpad io.clock</loc>
        </pinlocations>

        <gridlocations>
          <loc type="perimeter" priority="10"/>
        </gridlocations>

      </pb_type>

    <!-- Logic cluster definition -->
    <!-- k4 N8 I32 with no input crossbar (but LUT inputs are equivalent
         and each LUT has it's own dedicated inputs) -->
    <pb_type name="clb">
      <input name="I0" num_pins="4" equivalent="true"/>
      <input name="I1" num_pins="4" equivalent="true"/>
      <input name="I2" num_pins="4" equivalent="true"/>
      <input name="I3" num_pins="4" equivalent="true"/>
      <input name="I4" num_pins="4" equivalent="true"/>
      <input name="I5" num_pins="4" equivalent="true"/>
      <input name="I6" num_pins="4" equivalent="true"/>
      <input name="I7" num_pins="4" equivalent="true"/>
      <output name="O" num_pins="8" equivalent="false"/>
      <clock name="clk" num_pins="1"/>

      <!-- Describe basic logic element. -->
      <!-- Define 4LUT mode -->
          <pb_type name="ble4" num_pb="8">
            <input name="in" num_pins="4"/>
            <output name="out" num_pins="1"/>
            <clock name="clk" num_pins="1"/> 

            <!-- Define LUT -->
            <pb_type name="lut4" blif_model=".names" num_pb="1" class="lut">
              <input name="in" num_pins="4" port_class="lut_in"/>
              <output name="out" num_pins="1" port_class="lut_out"/>
              <!-- LUT timing using delay matrix -->
              <delay_matrix type="max" in_port="lut4.in" out_port="lut4.out">
              <!-- TODO: need to scale from 45nm to 22nm. Assume 45nm is at 0.9V -->
                2.063000e-10
                2.063000e-10
                2.063000e-10
                2.063000e-10
              </delay_matrix>
            </pb_type>

            <!-- Define flip-flop -->
            <pb_type name="ff" blif_model=".latch" num_pb="1" class="flipflop">
              <input name="D" num_pins="1" port_class="D"/>
              <output name="Q" num_pins="1" port_class="Q"/>
              <clock name="clk" num_pins="1" port_class="clock"/>
			  <!-- setup time included in LUT delay -->
              <!-- TODO: get FF params at 22nm -->
              <T_setup value="0.000000e-10" port="ff.D" clock="clk"/>
              <T_clock_to_Q max="8.406000e-11" port="ff.Q" clock="clk"/>
            </pb_type>

            <interconnect>
              <direct name="direct1" input="ble4.in" output="lut4[0:0].in"/>
              <direct name="direct2" input="lut4.out" output="ff.D">
                <!-- Advanced user option that tells CAD tool to find LUT+FF pairs in netlist -->
                <pack_pattern name="ble4" in_port="lut4.out" out_port="ff.D"/>
              </direct>
              <direct name="direct3" input="ble4.clk" output="ff.clk"/>                    
	      <!-- TODO: mux needs delay from ff.Q and ble4.out -->
              <mux name="mux1" input="ff.Q lut4.out" output="ble4.out">
              </mux>
            </interconnect>
          </pb_type>
      <interconnect>
        <!-- each input connects to its respective LUT. there is no xbar -->
        <direct name="directI0" input="clb.I0" output="ble4[0].in"/>
        <direct name="directI1" input="clb.I1" output="ble4[1].in"/>
        <direct name="directI2" input="clb.I2" output="ble4[2].in"/>
        <direct name="directI3" input="clb.I3" output="ble4[3].in"/>
        <direct name="directI4" input="clb.I4" output="ble4[4].in"/>
        <direct name="directI5" input="clb.I5" output="ble4[5].in"/>
        <direct name="directI6" input="clb.I6" output="ble4[6].in"/>
        <direct name="directI7" input="clb.I7" output="ble4[7].in"/>
        <!-- outputs -->
        <direct name="directO" input="ble4[7:0].out" output="clb.O"/>
        <!-- clock -->
        <complete name="clks" input="clb.clk" output="ble4[7:0].clk">
        </complete>
      </interconnect>

      <!-- Every input pin is driven by 15% of the tracks in a channel, every output pin is driven by 25% of the tracks in a channel -->
      <fc default_in_type="frac" default_in_val="0.15" default_out_type="frac" default_out_val="0.85"/>

      <pinlocations pattern="spread"/>

      <!-- The four inputs of a LUT are spread over the four sides of the CLB -->
      <!--pinlocations pattern="custom">
          <loc side="left">clb.I0[0] clb.I1[0] clb.I2[0] clb.I3[0] clb.I4[0] clb.I5[0] clb.I6[0] clb.I7[0] clb.O[1:0]</loc>
          <loc side="top">clb.I0[1] clb.I1[1] clb.I2[1] clb.I3[1] clb.I4[1] clb.I5[1] clb.I6[1] clb.I7[1] clb.O[3:2]</loc>
          <loc side="right">clb.I0[2] clb.I1[2] clb.I2[2] clb.I3[2] clb.I4[2] clb.I5[2] clb.I6[2] clb.I7[2] clb.O[5:4]</loc>
          <loc side="bottom">clb.I0[3] clb.I1[3] clb.I2[3] clb.I3[3] clb.I4[3] clb.I5[3] clb.I6[3] clb.I7[3] clb.O[7:6]</loc>
      </pinlocations-->

      <!-- For each LUT bring out inputs on a specific side of the CLB (same as "spread" pattern, no?) -->
      <!--pinlocations pattern="custom">
          <loc side="left">clb.I0[3:0] clb.I1[3:0] clb.O[1:0]</loc>
          <loc side="top">clb.I2[3:0] clb.I3[3:0] clb.O[3:2]</loc>
          <loc side="right">clb.I4[3:0] clb.I5[3:0] clb.O[5:4]</loc>
          <loc side="bottom">clb.I6[3:0] clb.I7[3:0] clb.O[7:6]</loc>
      </pinlocations-->

      <!-- Place this general purpose logic block in any unspecified column -->
      <gridlocations>
        <loc type="fill" priority="1"/>
      </gridlocations>
    </pb_type>
    <!-- Define general purpose logic block (CLB) ends -->

    </complexblocklist>
  </architecture>
